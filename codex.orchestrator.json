{
  "stageSets": {
    "build-lint-test": [
      {
        "kind": "command",
        "id": "build",
        "title": "npm run build",
        "command": "npm run build"
      },
      {
        "kind": "command",
        "id": "lint",
        "title": "npm run lint",
        "command": "npm run lint"
      },
      {
        "kind": "command",
        "id": "test",
        "title": "npm run test",
        "command": "npm run test"
      }
    ]
  },
  "pipelines": [
    {
      "id": "diagnostics",
      "title": "Diagnostics Pipeline",
      "description": "Build, lint, test, and spec-guard the repository with grouped runner support.",
      "tags": ["diagnostics-primary", "diagnostics-secondary"],
      "stages": [
        {
          "kind": "command",
          "id": "delegation-guard",
          "title": "node scripts/delegation-guard.mjs",
          "command": "node scripts/delegation-guard.mjs"
        },
        {
          "kind": "stage-set",
          "ref": "build-lint-test"
        },
        {
          "kind": "command",
          "id": "spec-guard",
          "title": "node scripts/spec-guard.mjs --dry-run",
          "command": "node scripts/spec-guard.mjs --dry-run"
        }
      ]
    },
    {
      "id": "implementation-gate",
      "title": "Implementation Complete Gate",
      "description": "Runs the required implementation validations (spec-guard, build, lint, test, docs:check, diff-budget) and launches the Codex review handoff, writing a single manifest for evidence.",
      "tags": ["implementation-gate"],
      "stages": [
        {
          "kind": "command",
          "id": "delegation-guard",
          "title": "node scripts/delegation-guard.mjs",
          "command": "node scripts/delegation-guard.mjs"
        },
        {
          "kind": "command",
          "id": "spec-guard",
          "title": "node scripts/spec-guard.mjs --dry-run",
          "command": "node scripts/spec-guard.mjs --dry-run"
        },
        {
          "kind": "stage-set",
          "ref": "build-lint-test"
        },
        {
          "kind": "command",
          "id": "docs-check",
          "title": "npm run docs:check",
          "command": "npm run docs:check"
        },
        {
          "kind": "command",
          "id": "diff-budget",
          "title": "node scripts/diff-budget.mjs",
          "command": "node scripts/diff-budget.mjs"
        },
        {
          "kind": "command",
          "id": "review",
          "title": "npm run review",
          "command": "npm run review",
          "env": {
            "DIFF_BUDGET_STAGE": "1",
            "CODEX_REVIEW_NON_INTERACTIVE": "1",
            "CODEX_REVIEW_DEVTOOLS": "0"
          }
        }
      ]
    },
    {
      "id": "implementation-gate-devtools",
      "title": "Implementation Complete Gate (DevTools Review)",
      "description": "Implementation gate with a DevTools-enabled review handoff for frontend QA/visual validation.",
      "tags": ["implementation-gate", "devtools-review"],
      "stages": [
        {
          "kind": "command",
          "id": "delegation-guard",
          "title": "node scripts/delegation-guard.mjs",
          "command": "node scripts/delegation-guard.mjs"
        },
        {
          "kind": "command",
          "id": "spec-guard",
          "title": "node scripts/spec-guard.mjs --dry-run",
          "command": "node scripts/spec-guard.mjs --dry-run"
        },
        {
          "kind": "stage-set",
          "ref": "build-lint-test"
        },
        {
          "kind": "command",
          "id": "docs-check",
          "title": "npm run docs:check",
          "command": "npm run docs:check"
        },
        {
          "kind": "command",
          "id": "diff-budget",
          "title": "node scripts/diff-budget.mjs",
          "command": "node scripts/diff-budget.mjs"
        },
        {
          "kind": "command",
          "id": "review",
          "title": "npm run review",
          "command": "npm run review",
          "env": {
            "DIFF_BUDGET_STAGE": "1",
            "CODEX_REVIEW_DEVTOOLS": "1",
            "CODEX_REVIEW_NON_INTERACTIVE": "1"
          }
        }
      ]
    },
    {
      "id": "docs-review",
      "title": "Docs Review Gate",
      "description": "Pre-implementation docs review: spec-guard, docs:check, and review (diff budget skipped).",
      "tags": ["docs-review"],
      "stages": [
        {
          "kind": "command",
          "id": "delegation-guard",
          "title": "node scripts/delegation-guard.mjs",
          "command": "node scripts/delegation-guard.mjs"
        },
        {
          "kind": "command",
          "id": "spec-guard",
          "title": "node scripts/spec-guard.mjs --dry-run",
          "command": "node scripts/spec-guard.mjs --dry-run"
        },
        {
          "kind": "command",
          "id": "docs-check",
          "title": "npm run docs:check",
          "command": "npm run docs:check"
        },
        {
          "kind": "command",
          "id": "review",
          "title": "npm run review",
          "command": "npm run review",
          "env": { "SKIP_DIFF_BUDGET": "1", "CODEX_REVIEW_NON_INTERACTIVE": "1" }
        }
      ]
    },
    {
      "id": "frontend-testing",
      "title": "Frontend Testing",
      "description": "Runs the frontend testing runner (DevTools off by default).",
      "tags": ["frontend-testing"],
      "guardrailsRequired": false,
      "stages": [
        {
          "kind": "command",
          "id": "frontend-testing",
          "title": "Run frontend testing",
          "command": "node dist/orchestrator/src/cli/frontendTestingRunner.js",
          "env": { "CODEX_REVIEW_DEVTOOLS": "0", "CODEX_NON_INTERACTIVE": "1" }
        }
      ]
    },
    {
      "id": "frontend-testing-devtools",
      "title": "Frontend Testing (DevTools)",
      "description": "Runs the frontend testing runner with Chrome DevTools enabled.",
      "tags": ["frontend-testing", "devtools"],
      "guardrailsRequired": false,
      "stages": [
        {
          "kind": "command",
          "id": "frontend-testing",
          "title": "Run frontend testing (DevTools enabled)",
          "command": "node dist/orchestrator/src/cli/frontendTestingRunner.js",
          "env": { "CODEX_REVIEW_DEVTOOLS": "1", "CODEX_NON_INTERACTIVE": "1" }
        }
      ]
    },
    {
      "id": "diagnostics-with-eval",
      "title": "Diagnostics Pipeline (with Eval Harness)",
      "description": "Build, lint, test, run evaluation harness, and verify specs for guardrail evidence capture.",
      "stages": [
        {
          "kind": "command",
          "id": "delegation-guard",
          "title": "node scripts/delegation-guard.mjs",
          "command": "node scripts/delegation-guard.mjs"
        },
        {
          "kind": "stage-set",
          "ref": "build-lint-test"
        },
        {
          "kind": "command",
          "id": "eval-test",
          "title": "npm run eval:test",
          "command": "npm run eval:test"
        },
        {
          "kind": "command",
          "id": "spec-guard",
          "title": "node scripts/spec-guard.mjs --dry-run",
          "command": "node scripts/spec-guard.mjs --dry-run"
        }
      ]
    },
    {
      "id": "design-reference",
      "title": "Design Reference Pipeline",
      "description": "Extracts design reference assets, stages Storybook-ready components, and records manifest evidence.",
      "tags": ["design", "reference"],
      "stages": [
        {
          "kind": "command",
          "id": "delegation-guard",
          "title": "node scripts/delegation-guard.mjs",
          "command": "node scripts/delegation-guard.mjs"
        },
        {
          "kind": "command",
          "id": "design-config",
          "title": "Resolve design configuration",
          "command": "node dist/scripts/design/pipeline/prepare.js",
          "env": { "DESIGN_PIPELINE": "1" }
        },
        {
          "kind": "command",
          "id": "design-extract",
          "title": "Run Playwright design extractor",
          "command": "node dist/scripts/design/pipeline/extract.js",
          "env": { "DESIGN_PIPELINE": "1" }
        },
        {
          "kind": "command",
          "id": "design-reference",
          "title": "Build motherduck reference page",
          "command": "node dist/scripts/design/pipeline/reference.js",
          "env": { "DESIGN_PIPELINE": "1" }
        },
        {
          "kind": "command",
          "id": "design-componentize",
          "title": "Componentize artifacts via packages/design-system",
          "command": "node dist/scripts/design/pipeline/componentize.js",
          "env": { "DESIGN_PIPELINE": "1" }
        },
        {
          "kind": "command",
          "id": "design-advanced-assets",
          "title": "Generate advanced design assets",
          "command": "node dist/scripts/design/pipeline/advanced-assets.js",
          "env": { "DESIGN_PIPELINE": "1" },
          "allowFailure": true,
          "summaryHint": "Optional Framer Motion and FFmpeg assets"
        },
        {
          "kind": "command",
          "id": "design-visual-regression",
          "title": "Run visual regression tests",
          "command": "node dist/scripts/design/pipeline/visual-regression.js",
          "env": { "DESIGN_PIPELINE": "1" },
          "allowFailure": true,
          "summaryHint": "Visual regression diffs stored under design/visual-regression/"
        },
        {
          "kind": "command",
          "id": "design-spec-guard",
          "title": "Validate specs via spec-guard",
          "command": "node scripts/spec-guard.mjs --dry-run",
          "env": { "DESIGN_PIPELINE": "1" },
          "summaryHint": "Ensures design specs are fresh before artifact write"
        },
        {
          "kind": "command",
          "id": "design-artifact-writer",
          "title": "Persist design artifact manifests",
          "command": "node dist/scripts/design/pipeline/write-artifacts.js",
          "env": { "DESIGN_PIPELINE": "1" }
        }
      ]
    },
    {
      "id": "hi-fi-design-toolkit",
      "title": "Hi-Fi Design Toolkit",
      "description": "Runs the hi-fi design toolkit pipeline to extract, tokenize, self-correct, and publish design artifacts.",
      "tags": ["design", "hi-fi"],
      "stages": [
        {
          "kind": "command",
          "id": "delegation-guard",
          "title": "node scripts/delegation-guard.mjs",
          "command": "node scripts/delegation-guard.mjs"
        },
        {
          "kind": "command",
          "id": "design-config",
          "title": "Resolve design configuration",
          "command": "node dist/scripts/design/pipeline/prepare.js",
          "env": { "DESIGN_PIPELINE": "1", "DESIGN_TOOLKIT": "1" }
        },
        {
          "kind": "command",
          "id": "design-toolkit-extract",
          "title": "Wrap external toolkit extractor",
          "command": "node dist/scripts/design/pipeline/toolkit/extract.js",
          "env": { "DESIGN_PIPELINE": "1", "DESIGN_TOOLKIT": "1" }
        },
        {
          "kind": "command",
          "id": "design-toolkit-tokens",
          "title": "Generate tokens and style guides",
          "command": "node dist/scripts/design/pipeline/toolkit/tokens.js",
          "env": { "DESIGN_PIPELINE": "1", "DESIGN_TOOLKIT": "1" }
        },
        {
          "kind": "command",
          "id": "design-toolkit-reference",
          "title": "Build reference pages + self-correction",
          "command": "node dist/scripts/design/pipeline/toolkit/reference.js",
          "env": { "DESIGN_PIPELINE": "1", "DESIGN_TOOLKIT": "1" }
        },
        {
          "kind": "command",
          "id": "design-advanced-assets",
          "title": "Generate advanced design assets",
          "command": "node dist/scripts/design/pipeline/advanced-assets.js",
          "env": { "DESIGN_PIPELINE": "1", "DESIGN_TOOLKIT": "1" },
          "allowFailure": true,
          "summaryHint": "Optional motion capture via Framer Motion + FFmpeg"
        },
        {
          "kind": "command",
          "id": "design-toolkit-publish",
          "title": "Publish toolkit outputs to packages/design-system",
          "command": "node dist/scripts/design/pipeline/toolkit/publish.js",
          "env": { "DESIGN_PIPELINE": "1", "DESIGN_TOOLKIT": "1" }
        },
        {
          "kind": "command",
          "id": "design-spec-guard",
          "title": "Validate specs via spec-guard",
          "command": "node scripts/spec-guard.mjs --dry-run",
          "env": { "DESIGN_PIPELINE": "1", "DESIGN_TOOLKIT": "1" },
          "summaryHint": "Ensures HI-FI design specs are current before artifact write"
        },
        {
          "kind": "command",
          "id": "design-artifact-writer",
          "title": "Persist design manifests",
          "command": "node dist/scripts/design/pipeline/write-artifacts.js",
          "env": { "DESIGN_PIPELINE": "1", "DESIGN_TOOLKIT": "1" }
        }
      ]
    },
    {
      "id": "tfgrpo-learning",
      "title": "TF-GRPO Learning Loop",
      "description": "Run three TF-GRPO epochs (~100 samples, train temp 0.7, eval temp 0.3, G>=2) and capture guardrail evidence.",
      "tags": ["tfgrpo-learning", "tfgrpo-learning-secondary"],
      "stages": [
        {
          "kind": "command",
          "id": "delegation-guard",
          "title": "node scripts/delegation-guard.mjs",
          "command": "node scripts/delegation-guard.mjs"
        },
        {
          "kind": "command",
          "id": "tfgrpo-loop",
          "title": "tfgrpo learning schedule (3 epochs, 100 samples)",
          "command": "TFGRPO_GROUP_SIZE=2 TFGRPO_REWARDERS=gt,relative TFGRPO_EPOCHS=3 TFGRPO_SAMPLE_SIZE=100 TFGRPO_TRAIN_TEMP=0.7 TFGRPO_EVAL_TEMP=0.3 node --loader ts-node/esm evaluation/harness/scripts/tfgrpo-runner.ts"
        },
        {
          "kind": "command",
          "id": "spec-guard",
          "title": "node scripts/spec-guard.mjs --dry-run",
          "command": "node scripts/spec-guard.mjs --dry-run"
        }
      ]
    }
  ]
}
