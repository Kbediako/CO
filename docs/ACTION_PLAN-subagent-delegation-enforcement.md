# Action Plan - Subagent Delegation Enforcement (Task 0918)

## Status Snapshot
- Current Phase: Implementation complete
- Run Manifest Link: `.runs/0918-subagent-delegation-enforcement/cli/2025-12-30T16-53-35-423Z-88c50e5f/manifest.json`
- Metrics / State Snapshots: `.runs/0918-subagent-delegation-enforcement/metrics.json`, `out/0918-subagent-delegation-enforcement/state.json`
- Approvals / Escalations: record in `tasks/index.json`

## Evidence Notes
- `metrics.json` is NDJSON (one JSON object per line; parse line-by-line).
- `out/0918-subagent-delegation-enforcement/state.json` is generated by metrics aggregation.

## Milestones & Tasks
1. Planning + collateral
   - Draft PRD/tech spec/action plan/checklist.
   - Update `tasks/index.json` and `docs/TASKS.md` mirrors.
   - Capture docs-review manifest.
2. Delegation guard implementation
   - Add `scripts/delegation-guard.mjs` with top-level/subagent detection.
   - Integrate guard into `codex.orchestrator.json` pipelines.
   - Document override behavior and naming rules.
3. Documentation + template updates
   - Update `AGENTS.md`, `docs/AGENTS.md`, `.agent/AGENTS.md`.
   - Update `.agent/SOPs/agent-autonomy-defaults.md` and `.agent/SOPs/meta-orchestration.md`.
   - Refresh task and subagent templates to require evidence.
4. Validation + handoff
   - Run implementation gate and capture guardrail evidence.
   - Update checklist mirrors with manifest paths.

## Risks & Mitigations
- Guard fails in legacy tasks without subagent runs.
  - Mitigation: require overrides with explicit `DELEGATION_GUARD_OVERRIDE_REASON` and record justification.
- Naming drift breaks subagent detection.
  - Mitigation: codify `<task-id>-<stream>` convention in templates and SOPs.
- Pipeline friction discourages use.
  - Mitigation: keep guard messaging explicit and actionable, provide one-line remediation steps.

## Next Review
- Date: 2026-01-20
- Agenda: confirm delegation guard enforcement, doc adoption, and override usage trends.
