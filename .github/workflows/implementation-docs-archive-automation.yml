name: Implementation Docs Archive Automation

on:
  schedule:
    - cron: '30 3 * * *'
  workflow_dispatch:
  push:
    branches: [main]
    paths:
      - docs/implementation-docs-archive-policy.json
      - docs/docs-freshness-registry.json
      - tasks/index.json
      - scripts/implementation-docs-archive.mjs

concurrency:
  group: implementation-docs-archive-automation
  cancel-in-progress: false

jobs:
  archive:
    uses: ./.github/workflows/archive-automation-base.yml
    permissions:
      contents: write
      pull-requests: write
    secrets: inherit
    with:
      run_command: node scripts/implementation-docs-archive.mjs
      task_id: implementation-docs-archive-automation
      archive_branch: doc-archives
      archive_out_dir: out/implementation-docs-archive-automation/docs-archive
      archive_glob: '*'
      archive_dest_dir: '.'
      pr_commit_message: "Archive implementation docs"
      pr_title: "Archive implementation docs"
      pr_body: |
        Automated implementation docs archive update.

        Archive payloads were pushed to the doc-archives branch.
      pr_branch: automation/implementation-docs-archive
