<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Orchestrator Monitor</title>
    <link rel="icon" href="favicon.svg" type="image/svg+xml" />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="bg-shape shape-a"></div>
    <div class="bg-shape shape-b"></div>
    <div class="app">
      <header class="topbar panel">
        <div class="brand">
          <div class="brand-title">Orchestrator Monitor</div>
          <div class="brand-sub">Local run status and codebase pulse</div>
        </div>
        <div class="controls">
          <div class="control">
            <label for="taskFilter">Task</label>
            <select id="taskFilter"></select>
          </div>
          <div class="control">
            <label for="bucketFilter">Bucket</label>
            <select id="bucketFilter">
              <option value="all">All</option>
              <option value="active">Active</option>
              <option value="ongoing">Ongoing</option>
              <option value="complete">Complete</option>
              <option value="pending">Pending</option>
            </select>
          </div>
          <div class="control search">
            <label for="searchInput">Search</label>
            <input id="searchInput" type="search" placeholder="Task, status, summary" />
          </div>
          <div class="control">
            <label>Sync</label>
            <button id="refreshBtn" type="button">Refresh</button>
          </div>
        </div>
      </header>

      <section class="kpi-grid">
        <div class="kpi-card" data-bucket="active">
          <div class="kpi-label">Active</div>
          <div class="kpi-value" id="kpi-active">0</div>
          <div class="kpi-detail" id="kpi-active-detail">Running now</div>
        </div>
        <div class="kpi-card" data-bucket="ongoing">
          <div class="kpi-label">Ongoing</div>
          <div class="kpi-value" id="kpi-ongoing">0</div>
          <div class="kpi-detail" id="kpi-ongoing-detail">Waiting on approvals</div>
        </div>
        <div class="kpi-card" data-bucket="complete">
          <div class="kpi-label">Complete</div>
          <div class="kpi-value" id="kpi-complete">0</div>
          <div class="kpi-detail" id="kpi-complete-detail">Terminal runs</div>
        </div>
        <div class="kpi-card" data-bucket="pending">
          <div class="kpi-label">Pending</div>
          <div class="kpi-value" id="kpi-pending">0</div>
          <div class="kpi-detail" id="kpi-pending-detail">No run yet</div>
        </div>
      </section>

      <section class="main-grid">
        <div class="panel task-panel">
          <div class="panel-header">Tasks</div>
          <div class="table-wrap">
            <table class="task-table">
              <thead>
                <tr>
                  <th>Task</th>
                  <th>Bucket</th>
                  <th>Status</th>
                  <th>Updated</th>
                  <th>Approvals</th>
                  <th>Summary</th>
                </tr>
              </thead>
              <tbody id="taskTableBody"></tbody>
            </table>
          </div>
        </div>
      </section>

      <div id="runOverlay" class="run-overlay" aria-hidden="true"></div>
      <div
        id="runModal"
        class="panel run-modal"
        role="dialog"
        aria-modal="true"
        aria-hidden="true"
        aria-labelledby="runModalTitle"
      >
        <div class="run-modal-header">
          <div id="runModalTitle" class="panel-header">Run Detail</div>
          <button id="runClose" class="run-close" type="button" aria-label="Close run details">Close</button>
        </div>
        <div id="runDetail" class="panel-body run-modal-body"></div>
      </div>

      <div id="sideOverlay" class="side-overlay" aria-hidden="true"></div>
      <aside id="sidePanel" class="side-panel" aria-hidden="true">
        <div class="side-panel-header">
          <div>
            <div class="panel-header">Signals</div>
            <div class="side-panel-sub">Codebase + activity</div>
          </div>
          <button id="sideClose" class="side-close" type="button" aria-label="Close">Close</button>
        </div>
        <details class="side-section" open>
          <summary>Codebase</summary>
          <div id="codebasePanel" class="panel-body"></div>
        </details>
        <details class="side-section">
          <summary>Recent Activity</summary>
          <div id="activityPanel" class="panel-body"></div>
        </details>
      </aside>
      <button id="sideToggle" class="side-toggle" type="button" aria-controls="sidePanel" aria-expanded="false">
        <span class="side-toggle-icon" aria-hidden="true">â‰¡</span>
        Signals
      </button>

      <footer class="footer">
        <div class="footer-left">
          <span id="dataSource">Data source: loading...</span>
          <span class="footer-item">
            Last update
            <span id="syncStatus" class="footer-status" role="status" aria-live="polite">Waiting...</span>
          </span>
        </div>
        <span class="footer-note">Auto-refresh every few seconds</span>
      </footer>
    </div>
    <script type="module" src="app.js"></script>
  </body>
</html>
