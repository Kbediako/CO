# Run Artifacts Directory

This directory stores per-task run manifests, transient logs, and reviewer-facing telemetry generated by the Codex Orchestrator and its MCP runner.

## Layout

- `.runs/0001/mcp/<run-id>/` — canonical artifact root for Task 0001 MCP executions. Each run contains:
  - `manifest.json` — per-command status, heartbeat metadata, resume token, metrics bookkeeping (`metrics_recorded`), and run-level summary guidance (diagnostics recommendations when guardrails are missing or failing).
  - `runner.log` — aggregated stdout/stderr from the MCP runner process.
  - `.heartbeat` — last heartbeat timestamp written every 10 seconds while the runner is active.
  - `.resume-token` — the 32-byte token required by `scripts/mcp-runner-start.sh --resume` to reattach to a run.
  - `<index>-<slug>.json` — raw tool responses captured for each command.
  - `errors/<index>-<slug>.json` — structured failure artifacts with raw tool payloads and summaries when commands return malformed responses or non-zero exit codes (referenced via `manifest.commands[].error_file`).
  - `poll.json` — optional JSON snapshot produced via `scripts/mcp-runner-poll.sh <run-id> --format json` for reviewer automation.
- `.runs/local-mcp/<run-id>/` — compatibility pointer re-created during each run/migration. When symlinks are not supported, the directory contains a JSON stub (`manifest.json`) with `redirect_to` and `manifest` fields.
- `.runs/0001/metrics.json` — JSON Lines stream appended after each run reaches a terminal state (success/failure/cancelled).
- `.runs/0001/metrics-summary.json` — aggregate statistics generated via `scripts/mcp-runner-metrics.js` (success rate, average duration, guardrail coverage).
- `.runs/0001/migrations/<timestamp>.log` — audit records produced by `scripts/mcp-runner-migrate.js` in either dry-run or execution mode.

## Notes

- All timestamps are stored in ISO 8601 format; heartbeat staleness is derived from `manifest.heartbeat_at` with a 30 second threshold.
- The MCP runner refuses to start if it cannot write both the task-scoped artifact root and the compatibility pointer.
- Resume events are tracked in `manifest.resume_events[]` with actor/reason metadata to help reviewers trace handoffs.
- Failed commands produce dedicated error artifacts under `errors/` so reviewers can inspect malformed payloads without replaying the run.
- When the spec-guard command is missing or fails, the runner logs a recommendation to run `scripts/run-mcp-diagnostics.sh --no-watch` and records the guidance in `manifest.summary` for reviewer follow-through.
- Reviewers should cite `.runs/0001/metrics-summary.json` alongside the specific run manifest when validating checklist entries.
