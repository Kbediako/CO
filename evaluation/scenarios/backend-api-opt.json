{
    "id": "backend-api-opt",
    "title": "Backend API Optimization (N+1)",
    "adapterId": "typescript-default",
    "goals": [
        {
            "goal": "test",
            "timeoutMs": 30000
        }
    ],
    "agentTask": {
        "instruction": "WRITE|src/routes/users.js|const { db } = require('../db');\n\nasync function getUsersWithPosts() {\n  const users = await db.getUsers();\n\n  const allPosts = await db.getAllPosts();\n  const usersWithPosts = users.map((user) => ({\n    ...user,\n    posts: allPosts.filter((post) => post.userId === user.id)\n  }));\n\n  return usersWithPosts;\n}\n\nmodule.exports = { getUsersWithPosts };\n"
    },
    "fixture": {
        "path": "evaluation/fixtures/node-api-nplus1",
        "copyToTemp": true
    },
    "patternAssertions": [
        {
            "type": "diff-match",
            "scope": "fixture",
            "path": "src/routes/users.js",
            "expectedDiff": "@@ ... @@\n-  const usersWithPosts = [];\n-  for (const user of users) {\n-    const posts = await db.getPostsForUser(user.id);\n-    usersWithPosts.push({ ...user, posts });\n-  }\n+  const allPosts = await db.getAllPosts();\n+  const usersWithPosts = users.map((user) => ({\n+    ...user,\n+    posts: allPosts.filter((post) => post.userId === user.id)\n+  }));"
        }
    ]
}
